<p>In July and August I attended the <a href="http://2014.okfestival.org/" data-cite-meta="{}">Open Knowledge Festival <span class="citation" data-cites="http://2014.okfestival.org/">(<strong>http://2014.okfestival.org/?</strong>)</span></a> and <a href="http://wikimania2014.wikimedia.org/wiki/Programme" data-cite-meta="{}">Wikimania <span class="citation" data-cites="http://wikimania2014.wikimedia.org/wiki/Programme">(<strong>http://wikimania2014.wikimedia.org/wiki/Programme?</strong>)</span></a>. At both events I had many interesting discussions around open source tools for open access scholarly publishing, and I was part of a <a href="http://wikimania2014.wikimedia.org/wiki/Submissions/The_Full_OA_Stack_-_Open_Access_and_Open_Source" data-cite-meta="{}">panel <span class="citation" data-cites="http://wikimania2014.wikimedia.org/wiki/Submissions/The_Full_OA_Stack_-_Open_Access_and_Open_Source">(<strong>http://wikimania2014.wikimedia.org/wiki/Submissions/The_Full_OA_Stack_-_Open_Access_and_Open_Source?</strong>)</span></a> on that topic at Wikimania last Sunday. Some of my thoughts were summarized in a blog post a few weeks ago (<a href="https://blog.martinfenner.org/posts/roads-not-stagecoaches/" data-cite-meta="{}">Build Roads not Stagecoaches <span class="citation" data-cites="https://blog.martinfenner.org/posts/roads-not-stagecoaches/">(<strong>https://blog.martinfenner.org/posts/roads-not-stagecoaches/?</strong>)</span></a>). Today I am happy to announce the first public release of a tool that hopefully contributes to making publishing of open content a bit easier.</p>
<figure>
<img src="http://blog.martinfenner.org/images/rakali.jpg" class="kg-image" alt="LEGO Researchers are excited that they don’t have to use Microsoft Word for manuscript writing anymore." /><figcaption aria-hidden="true">LEGO Researchers are excited that they don’t have to use Microsoft Word for manuscript writing anymore.</figcaption>
</figure>
<p><a href="https://github.com/rakali/rakali.rb" data-cite-meta="{}">Rakali <span class="citation" data-cites="https://github.com/rakali/rakali.rb">(<strong>https://github.com/rakali/rakali.rb?</strong>)</span></a> is a Ruby gem that acts as a wrapper for the <a href="http://johnmacfarlane.net/pandoc/" data-cite-meta="{}">Pandoc <span class="citation" data-cites="http://johnmacfarlane.net/pandoc/">(<strong>http://johnmacfarlane.net/pandoc/?</strong>)</span></a> universal document converter. Pandoc is a wonderful tool to convert documents between file formats and supports many file formats and features important for scholarly publishing. Pandoc 1.13 was <a href="http://johnmacfarlane.net/pandoc/releases.html" data-cite-meta="{}">released <span class="citation" data-cites="http://johnmacfarlane.net/pandoc/releases.html">(<strong>http://johnmacfarlane.net/pandoc/releases.html?</strong>)</span></a> last Friday, and one of the most exciting new features is a reader for Microsoft Word (<code>docx</code>) documents. Pandoc has supported the conversion to <code>docx</code> for a while, but now you can use the most popular file format for writing scholarly documents and turn your <code>docx</code> files into HTML, PDF, LateX, markdown, or a number of other formats, making it much easier to collaborate, and to use <code>docx</code> with Pandoc in scholarly publishing workflows. A good example would be arXiv, which <a href="http://arxiv.org/help/submit#text" data-cite-meta="{}">doesn’t support <span class="citation" data-cites="http://arxiv.org/help/submit#text">(<strong>http://arxiv.org/help/submit#text?</strong>)</span></a> <code>docx</code> for text submissions. Instead of turning it into PDF the manuscript can now be converted to LaTeX - the preferred file format at arXiv - before submission.</p>
<p>I built <strong><strong>Rakali</strong></strong> to make it easier to use Pandoc to convert large numbers of documents in an automated way:</p>
<ul>
<li>bulk conversion of all files in a folder with a specific extension, e.g. <code>md</code>.</li>
<li>input via a configuration file in yaml format instead of via the command line</li>
<li>validation of documents via <a href="http://json-schema.org/" data-cite-meta="{}">JSON Schema <span class="citation" data-cites="http://json-schema.org/">(<strong>http://json-schema.org/?</strong>)</span></a>, using the <a href="https://github.com/hoxworth/json-schema" data-cite-meta="{&quot;URL&quot;:&quot;https://github.com/ruby-json-schema/json-schema&quot;,&quot;abstract&quot;:&quot;Ruby JSON Schema Validator. Contribute to ruby-json-schema/json-schema development by creating an account on GitHub.&quot;,&quot;accessed&quot;:{&quot;date-parts&quot;:[[2021,2,23]]},&quot;id&quot;:&quot;https://github.com/hoxworth/json-schema&quot;,&quot;issued&quot;:{&quot;date-parts&quot;:[[2021,2]]},&quot;note&quot;:&quot;original-date: 2010-11-24T20:05:16Z&quot;,&quot;publisher&quot;:&quot;ruby-json-schema&quot;,&quot;title&quot;:&quot;ruby-json-schema/json-schema&quot;,&quot;type&quot;:&quot;&quot;}">json-schema <span class="citation" data-cites="https://github.com/hoxworth/json-schema">(<em>Ruby-Json-Schema/Json-Schema</em>, 2021)</span></a> Ruby gem.</li>
<li>Logging via <code>stdout</code> and <code>stderr</code>.</li>
</ul>
<p>One interesting way to use Rakali and Pandoc is as part of a <a href="https://blog.martinfenner.org/posts/continuous-publishing/" data-cite-meta="{}">continuous publishing <span class="citation" data-cites="https://blog.martinfenner.org/posts/continuous-publishing/">(<strong>https://blog.martinfenner.org/posts/continuous-publishing/?</strong>)</span></a> workflow that involves git and Github, automatically converting all files in a folder when something is pushed to the repository using a continuous integration tool, and exiting the continuous integration run when one of the files doesn’t validate. Look into the Rakali <a href="https://github.com/rakali/rakali.rb" data-cite-meta="{}">repo <span class="citation" data-cites="https://github.com/rakali/rakali.rb">(<strong>https://github.com/rakali/rakali.rb?</strong>)</span></a> for an example.</p>
<p>The most interesting aspect of Rakali is probably validation via JSON Schema. File conversion with Pandoc is a two-step process, the intermediate format is an internal representation of the document in something called the <a href="https://blog.martinfenner.org/posts/the-grammar-of-scholarly-communication/" data-cite-meta="{}">abstract syntax tree <span class="citation" data-cites="https://blog.martinfenner.org/posts/the-grammar-of-scholarly-communication/">(<strong>https://blog.martinfenner.org/posts/the-grammar-of-scholarly-communication/?</strong>)</span></a> or AST. Pandoc makes the AST accessible in JSON format, making it straightforward to manipulate a document before the conversion into the target format with something called <a href="http://johnmacfarlane.net/pandoc/scripting.html" data-cite-meta="{}">JSON filters <span class="citation" data-cites="http://johnmacfarlane.net/pandoc/scripting.html">(<strong>http://johnmacfarlane.net/pandoc/scripting.html?</strong>)</span></a>.</p>
<p>Validation of XML documents using <a href="https://en.wikipedia.org/wiki/Document_type_definition" data-cite-meta="{}">DTDs <span class="citation" data-cites="https://en.wikipedia.org/wiki/Document_type_definition">(<strong>https://en.wikipedia.org/wiki/Document_type_definition?</strong>)</span></a>, <a href="http://relaxng.org/" data-cite-meta="{}">RELAX NG <span class="citation" data-cites="http://relaxng.org/">(<strong>http://relaxng.org/?</strong>)</span></a> and other standards has of course been around for a long time, but validation of JSON documents is still relatively new. Since many Pandoc document conversion workflows don’t involve any XML I thought it would make more sense to validate against the AST, and we can use JSON Schema for that. I have started a <a href="https://github.com/rakali/pandoc-schemata" data-cite-meta="{}">Github repository <span class="citation" data-cites="https://github.com/rakali/pandoc-schemata">(<strong>https://github.com/rakali/pandoc-schemata?</strong>)</span></a> with schemata for the Pandoc AST, and hope to evolve them over time using Rakali as a tool. An example log output (from the Rakali test suite, stopping file conversion because title and layout metadata are missing) looks like this:</p>
<pre><code>Validation Error: The property &#39;#/0/unMeta&#39; did not contain a required property of &#39;title&#39; in schema 9b6d454d-e609-537b-b761-9599b6c01072# for file empty.md
Validation Error: The property &#39;#/0/unMeta&#39; did not contain a required property of &#39;layout&#39; in schema 9b6d454d-e609-537b-b761-9599b6c01072# for file empty.md
Fatal: Conversion of file empty.md failed.</code></pre>
<p>As I had argued before, the challenge for building open source tools for science is to <a href="https://blog.martinfenner.org/posts/dont-reinvent-the-wheel/" data-cite-meta="{}">not duplicate the work of others <span class="citation" data-cites="https://blog.martinfenner.org/posts/dont-reinvent-the-wheel/">(<strong>https://blog.martinfenner.org/posts/dont-reinvent-the-wheel/?</strong>)</span></a>, and to integrate well with existing tools by focussing on one aspect and doing that aspect well. It also helps to think about infrastructure (<a href="https://blog.martinfenner.org/posts/roads-not-stagecoaches/" data-cite-meta="{}">the roads <span class="citation" data-cites="https://blog.martinfenner.org/posts/roads-not-stagecoaches/">(<strong>https://blog.martinfenner.org/posts/roads-not-stagecoaches/?</strong>)</span></a>) instead of only focussing on the user-facing aspects. There are obviously many document conversion tools out there, but Pandoc is certainly one of the oldest and most established ones for scholarly content. Rakali therefore builds on top of Pandoc and tries to play well with other existing tools and services, e.g. by using the UNIX <code>stdout</code> and <code>stderr</code> for reporting, and by using a file-based approach that works well with version control systems such as git. And since Rakali is a Ruby gem it can not only be used as a standalone command line tool, but can also be easily integrated into other Ruby applications.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-https://web.archive.org/web/20170913072431/http://schema.org/BlogPosting" class="csl-entry" role="doc-biblioentry">
BlogPosting - schema.org. (2017). In <em>web.archive.org</em>. <a href="https://web.archive.org/web/20170913054050/http://schema.org/BlogPosting">https://web.archive.org/web/20170913054050/http://schema.org/BlogPosting</a>
</div>
<div id="ref-https://github.com/hoxworth/json-schema" class="csl-entry" role="doc-biblioentry">
<em>ruby-json-schema/json-schema</em>. (2021). ruby-json-schema. <a href="https://github.com/ruby-json-schema/json-schema">https://github.com/ruby-json-schema/json-schema</a>
</div>
<div id="ref-http://www.digital-science.com/events/scifoo-camp-2015/" class="csl-entry" role="doc-biblioentry">
SciFoo Camp 2015. (n.d.). In <em>Digital Science</em>. Retrieved February 23, 2021, from <a href="https://www.digital-science.com/events/scifoo-camp-2015/">https://www.digital-science.com/events/scifoo-camp-2015/</a>
</div>
</div>
