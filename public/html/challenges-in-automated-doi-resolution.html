<p>Yesterday we created a set of roughly 10,000 DOIs for journal articles published in 2011 or 2012. We used these DOIs as a reference set in a <a href="http://almdatachallenge.eventbrite.com/">data hackathon</a> around article-level metrics/altmetrics - material for another blog post.</p>
<p>The random DOis were generated using the <a href="http://random.labs.crossref.org/">CrossRef RanDOIm service</a>, with article titles fetched from the <a href="http://labs.crossref.org/openurl/">CrossRef OpenURL API</a>. We didn’t have time to properly parse the publication date and only used the publication year. We used the <code>crossref_r</code> and <code>crossref</code> functions from the rOpenSci <a href="http://ropensci.github.io/rplos/">rplos package</a> (and some extra help from Scott Chamberlain) to achieve this, the datasets were deposited to figshare and can be found <a href="http://dx.doi.org/10.6084/m9.figshare.821209">here</a> (2011) and <a href="http://dx.doi.org/10.6084/m9.figshare.821213">here</a> (2012).</p>
<p>The basic idea behind DOI names is summarized well in the <a href="http://en.wikipedia.org/wiki/Digital_object_identifier">Wikipedia entry</a>:</p>
<blockquote>
A digital object identifier (DOI) is a character string (a “digital identifier”) used to uniquely identify an object such as an electronic document. Metadata about the object is stored in association with the DOI name and this metadata may include a location, such as a URL, where the object can be found. The DOI for a document is permanent, whereas its location and other metadata may change. Referring to an online document by its DOI provides more stable linking than simply referring to it by its URL, because if its URL changes, the publisher need only update the metadata for the DOI to link to the new URL.
</blockquote>
<p>DOIs for journal articles should provide users with a URL specific for that journal article. This URL could point to a digital copy of the journal article in HTML or PDF format, or could point to a landing page (with an abstract or other basic metadata) for journal articles that require a subscription. This should work not only for humans using a web browser, but also for automated services using command line tools such as <a href="http://curl.haxx.se/">curl</a> as scientific infrastructure depends heavily on automation and computers talking to each other. In our use case we want to find content linking to a specific article, and as some services (e.g. social media) will use the URL and not DOI of an article, we need to find out that URL.</p>
<p>Unfortunately it was difficult to find a URL for many DOIs in our reference set using automated tools. All these DOIs resolve to URLs for human users using a web browser, but for automated tools there are a number of challenges:</p>
<h3 id="requiring-a-cookie">Requiring a cookie</h3>
<p>Some publishers require a cookie, and that can cause problems for automated tools. We can use the popular command line tool <code>curl</code> with the options <code>-L</code> to follow redirects and <code>-I</code> to only send the header (as we care about the location and not the content of the page).</p>
<pre><code>curl -I -L &quot;http://dx.doi.org/10.1080/13658816.2010.531020&quot;</code></pre>
<p>This command will lead us not to a page specific for that article, but to a “Cookie absent” page. You can work around this by having curl accept cookies:</p>
<pre><code>curl -I -L --cookie &quot;tmp&quot; &quot;http://dx.doi.org/10.1080/13658816.2010.531020&quot;</code></pre>
<p>Unfortunately not all tools do this. The way Facebook tracks likes, shares, comments, etc. is a prominent example.</p>
<h3 id="too-many-redirects">Too many redirects</h3>
<p>Some DOIs never resolve using a HEAD request, and curl stops after 50 redirects:</p>
<pre><code>curl -I -L &quot;http://dx.doi.org/10.1097/SLA.0b013e318235e525&quot;</code></pre>
<p>This error may relate to the “requiring a cookie” error above.</p>
<h3 id="method-not-allowed">Method not allowed</h3>
<p>Some DOis HEAD requests result in a “405 Method Not Allowed” error. The reason is that the journal platform doesn’t accept the HEAD request, but wants a GET instead.</p>
<pre><code>curl -I -L &quot;http://dx.doi.org/10.1002/sam.10120&quot;</code></pre>
<p>The <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">HTTP 1.1 protocol</a> says about HEAD:</p>
<blockquote>
The HEAD method is identical to GET except that the server MUST NOT return a message-body in the response. … This method is often used for testing hypertext links for validity, accessibility, and recent modification.
</blockquote>
<p>We can work around this error by using a GET request, which unfortunately creates extra overhead and is not the recommended way to obtain this kind of information.</p>
<h3 id="empty-reply-from-server">Empty reply from server</h3>
<p>Some DOIs never resolve using a HEAD because curl reports “Empty reply from server” and we don’t get a HTTP 200 status code.</p>
<pre><code>curl -I -L &quot;http://dx.doi.org/10.1016/j.cca.2011.04.012&quot;</code></pre>
<p>You can again work around this by using the location information before the last redirect, but maybe resolving a DOI should not result in curl routinely throwing an error. It looks as if this error is related to “method not allowed”, as a GET request resolves to a landing page.</p>
<p>This problem is not specific to the <code>curl</code> tool, we get exactly the same error with <code>wget</code>:</p>
<pre><code>wget -S --spider &quot;http://dx.doi.org/10.1016/j.cca.2011.04.012&quot;</code></pre>
<h3 id="timeout-errors">Timeout errors</h3>
<p>Some DOI resolutions resulted in timeout errors, but this was temporary and much less frequent than the errors above.</p>
<h3 id="resource-not-found">Resource not found</h3>
<p>We didn’t specifically look into this error, which is a well-known problem with URLs. The DOI names we used were from 2011 and 2012, and it is known that <a href="http://en.wikipedia.org/wiki/Link_rot">link rot</a> is more common the older the resource is.</p>
<h3 id="content-negotiation">Content negotiation</h3>
<p>As Karl Ward has pointed out in the comments there are other ways to get to the URL from the DOI name, e.g. using content negotiation:</p>
<pre><code>curl -LH &quot;Accept: application/vnd.crossref.unixref+xml&quot; &quot;http://dx.doi.org/10.1016/j.cca.2011.04.012&quot;</code></pre>
<p>The URL is stored in the <code>doi_data/resource</code> attribute. The URL stored there is unfortunately not always the final landing page for the article, e.g. for the DOI name used in the example above.</p>
<h3 id="conclusions">Conclusions</h3>
<p>We created a reference set of 10,000 DOIs to collect metrics around them. The first conclusion from this exercise is that getting the URL for these articles is a challenge in many cases. This does not seem to relate to a permission problem for subscription content, but rather how the HTTP HEAD request is handled. Content negotiation is one alternative, but sometimes leads to different URLs for the landing page than where the user would get via the browser. We therefore have to rewrite our code to use GET requests and to better handle the scenarios above.</p>
<p><em>Update 10/13/13: Updated the title and the text to make it clear that I am not talking about DOIs that don’t resolve for human users, but rather about the problems automating this process using command-line tools.</em></p>
